/*created by lx58 on 12/12/2016*/
/*
 *  Project: PhotoSticker web app based on PicEdit by Andy V. and fabric.js
 *  Description: Allows user to take a selfie or upload a photo with tools to edit the image on the front-end and apply stickers to it
 *               The user can then download the profile, download a Zip file for all stickers and share on social media.
 *  Author: Lin Xue
 *  License: MIT
 */

function validateEmail(a){var b=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return b.test(a)}function bindEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}$(function(){function b(b){b.preventDefault();var c=$("#email").val(),d=document.getElementById("canvas").fabric,e=d.item(0);if(e)if(validateEmail(c)){$("#result").text("");var f=new JSZip,g=d.item(1);g&&d.remove(g);for(var h=document.getElementsByTagName("img"),i=0;i<h.length;i++){var j=h[i].id,k=document.getElementById(j),l=new fabric.Image(k,{left:20,top:270,scaleX:1.5,scaleY:1.5,lockUniScaling:!0,hasControls:!1,hasBorders:!1});d.insertAt(l,1,!1);var m=new Image;m.src=d.toDataURL();var n=m.src.substr(m.src.indexOf(",")+1);f.file("profile_"+i+".png",n,{base64:!0}),d.remove(l)}f.generateAsync({type:"blob"}).then(function(a){saveAs(a,"CUprofile.zip")},function(b){a.innerHTML+=" "+b}),$("#email_form").submit()}else $("#result").text("You must enter a valid email address!").css("color","red");else $("#result").text("Please take a selfie or upload a photo first!").css("color","red");return!1}$("#thebox").picEdit();var a=document.getElementById("message_submit");JSZip.support.blob?bindEvent(a,"click",b):a.innerHTML+=" (not supported on this browser)",$("#socialshare").click(function(){$(".socialfloat").css("display","block"),setTimeout(function(){$(".socialfloat").css("display","none")},7e3)}),$(".share").click(function(){var a=window.open($(this).prop("href"),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600");return window.focus&&a.focus(),!1})}),$.fn.slideFadeToggle=function(a,b){return this.animate({opacity:"toggle",height:"toggle"},"fast",a,b)};