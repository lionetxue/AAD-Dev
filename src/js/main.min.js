/**
 * Created by lx58 on 12/9/2016.
 */
function deselect(a){$(".pop").slideFadeToggle(function(){a.removeClass("selected"),$("#result").text("")})}function validateEmail(a){var b=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return b.test(a)}function bindEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}$(function(){function b(b){b.preventDefault();var c=$("#email").val(),d=document.getElementById("canvas").fabric,e=d.item(0);if(e)if(validateEmail(c)){$("#result").text(""),$("#hidden_sticker").removeClass("hidden_sticker").addClass("picedit_sticker"),$("#sticker_lock").hide(),document.getElementById("hidden_sticker").style.pointerEvents="auto";var f=new JSZip,g=d.item(1);g&&d.remove(g);for(var h=document.getElementsByTagName("img"),i=0;i<h.length;i++){var j=h[i].id,k=document.getElementById(j),l=new fabric.Image(k,{left:20,top:270,scaleX:1.5,scaleY:1.5,lockUniScaling:!0,hasControls:!1,hasBorders:!1});d.insertAt(l,1,!1);var m=new Image;m.src=d.toDataURL();var n=m.src.substr(m.src.indexOf(",")+1);f.file("profile_"+i+".png",n,{base64:!0}),d.remove(l)}f.generateAsync({type:"blob"}).then(function(a){saveAs(a,"CUprofile.zip")},function(b){a.innerHTML+=" "+b}),$("#email_form").submit()}else $("#result").text("You must enter a valid email address!").css("color","red");else $("#result").text("Please take a selfie or upload a photo first!").css("color","red");return!1}$("#thebox").picEdit(),document.getElementById("hidden_sticker").style.pointerEvents="none",$("#downloadZip").on("click",function(){return $(this).hasClass("selected")?deselect($(this)):($(this).addClass("selected"),$(".pop").slideFadeToggle()),!1}),$(".close").on("click",function(){return deselect($("#downloadZip")),$("#result").text(""),!1});var a=document.getElementById("message_submit");JSZip.support.blob?bindEvent(a,"click",b):a.innerHTML+=" (not supported on this browser)",$("#socialshare").click(function(){$(".socialfloat").css("display","block"),setTimeout(function(){$(".socialfloat").css("display","none")},7e3)}),$(".share").click(function(){var a=window.open($(this).prop("href"),"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600");return window.focus&&a.focus(),!1})}),$.fn.slideFadeToggle=function(a,b){return this.animate({opacity:"toggle",height:"toggle"},"fast",a,b)};