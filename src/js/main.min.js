/*created by lx58 on 12/12/2016*/
/*
 *  Project: PhotoSticker web app based on PicEdit by Andy V. and fabric.js
 *  Description: Allows user to take a selfie or upload a photo with tools to edit the image on the front-end and apply stickers to it
 *               The user can then download the profile, download a Zip file for all stickers and share on social media.
 *  Author: Lin Xue
 *  License: MIT
*/

function validateEmail(a){var b=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return b.test(a)}function bindEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function downloadWithBlob(a){a.preventDefault();var b=$("#email").val(),c=document.getElementById("canvas").fabric,d=c.item(0);if(d)if(validateEmail(b)){$("#result").text("");var e=new JSZip,f=c.item(1);f&&c.remove(f);for(var g=document.getElementsByTagName("img"),h=0;h<g.length;h++){var i=g[h].id,j=document.getElementById(i),k=new fabric.Image(j,{left:20,top:270,scaleX:1.5,scaleY:1.5,lockUniScaling:!0,hasControls:!1,hasBorders:!1});c.insertAt(k,1,!1);var l=new Image;l.src=c.toDataURL();var m=l.src.substr(l.src.indexOf(",")+1);e.file("profile_"+h+".png",m,{base64:!0}),c.remove(k)}e.generateAsync({type:"blob"}).then(function(a){saveAs(a,"CUprofile.zip")},function(a){blobLink.innerHTML+=" "+a}),$("#email_form").submit()}else $("#result").text("You must enter a valid email address!").css("color","red");else $("#result").text("Please take a selfie or upload a photo first!").css("color","red");return!1}$(function(){$("#thebox").picEdit()}),$.fn.slideFadeToggle=function(a,b){return this.animate({opacity:"toggle",height:"toggle"},"fast",a,b)};